<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prime Numbers</title>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /*
     * ==================================================================
     * ====================== global & reset style ======================
     * ==================================================================
    */
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family: 'Comfortaa', 'Segoe UI', sans-serif;
    }

    body {
      background-color: #121212;
      color: #e0e0e0;
      overflow: hidden;
    }

    /*
     * ===============================================================
     * ====================== layout  & scaling ======================
     * ===============================================================
    */
    .scale-container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      background-color: #121212;
    }

    .scale-wrapper {
      transform-origin: center;
    }

    .applet-canvas {
      width: 1920px;
      height: 1080px;
      position: relative;
    }

    .applet-container {
      width: 1920px;
      height: 1080px;
      display: flex;
      flex-direction: column;
      margin: 0 auto;
      overflow: hidden;
      background-color: #121212;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      position: relative;
    }

    .assets {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      overflow: hidden;
    }

    .workingArea-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      background-color: #1a1a1a;
      overflow: hidden;
    }

    .workingArea {
      flex: 1;
      border: 3px solid #FF6B9E;
      border-radius: 16px;
      background-color: #222222;
      box-shadow: 0 0 15px rgba(255, 107, 158, 0.3);
      margin: 8px 0;
      position: relative;
      display: flex;
      padding: 0;
      height: 100%;
    }

    /*
     * ================================================================
     * ====================== core ui components ======================
     * ================================================================
    */

    /* --- title  bar --- */
    .titleBar {
      background: linear-gradient(to right, #FF6B9E, #9C6AFF);
      padding: 12px 20px;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      border-radius: 16px 16px 0 0;
      position: relative;
    }

    #appletTitle {
      font-size: 1.8rem;
      font-weight: 600;
    }

    /* --- instruction panel --- */
    .instruction {
      text-align: center;
      font-size: 2rem;
      font-weight: 600;
      margin: 10px 0;
      color: #FFD166;
      padding: 10px;
      background-color: rgba(255, 209, 102, 0.1);
      border-radius: 12px;
    }

    span.focus {
      font-size: 1.2em;
      font-weight: 700;
      color: #fff;
    }

    #langToggle {
      position: absolute;
      top: 48px;
      left: 48px;
      background: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 1.5rem;
      color: #FF6B9E;
      z-index: 99;
      display: none; /* Hide the language toggle button */
    }

    /* --- marquee --- */
    /* Calculate logo right edge: left (20px) + max-width (150px) = 170px */
    .top-marquee {
      position: fixed;
      top: 0;
      left: 170px; /* Start from logo right edge */
      right: 0; /* End at screen right edge */
      height: 4.25vh;
      background-color: rgba(0, 0, 0, 0.35);
      color: white;
      display: flex;
      align-items: center;
      overflow: hidden;
      z-index: 90;
      pointer-events: none;
    }

    .top-marquee-text {
      position: absolute;
      white-space: nowrap;
      animation: marquee-scroll 20s linear infinite;
      font-size: 1.2rem;
      color: white;
      left: 100%;
    }

    @keyframes marquee-scroll {
      0% {
        left: 100%;
      }
      100% {
        left: -150%;
      }
    }

    /* --- logo --- */
    .logo {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 101;
      max-width: 150px;
      max-height: 80px;
      object-fit: contain;
    }

    /* --- navigation controls --- */
    .lowerControls {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      padding: 16px 24px;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .nav-btn {
      min-height: 60px;
      padding: 12px 32px;
      margin: 0 10px;
      border: none;
      border-radius: 50px;
      font-size: 1.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
      background: linear-gradient(145deg, #fdbe35, #fba92d);
      box-shadow:
        0 20px 20px rgba(251, 169, 45, 0.3),
        inset 0 2px 1px rgba(255, 255, 255, 0.5),
        inset 0 -2px 3px rgba(0, 0, 0, 0.1),
        0 4px 0px rgba(206, 141, 0, 0.6);
      text-shadow: 0px 1px 2px rgba(175, 144, 5, 0.89);
    }

    .nav-btn:hover:not(:disabled) {
      transform: translateY(-2px);
    }

    .nav-btn:active:not(:disabled) {
      background: linear-gradient(145deg, #fba92d, #f9a825);
      box-shadow: 0 4px 8px rgba(251, 155, 45, 0.3), inset 0 2px 3px rgba(0, 0, 0, 0.3);
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      background: #666;
    }

    /*
     * ====================================================================
     * ====================== screen specific styles ======================
     * ====================================================================
    */

    /* --- start screen styles --- */
    .start-screen-container {
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      width: calc(100% + 6px);
      height: calc(100% + 6px);
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border-radius: 16px;
      z-index: 1;
    }

    .start-content-wrapper {
      display: flex;
      align-items: center;
      gap: 80px;
      max-width: 1400px;
      width: 100%;
      justify-content: center;
    }

    .start-wizard-container {
      display: flex;
      align-items: center;
      justify-content: center;
      transform: scaleX(-1);
    }

    #start-wizard-char {
      height: 500px;
      user-select: none;
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
    }

    .start-dialogue-box {
      padding: 50px 60px;
      border-radius: 40px;
      max-width: 700px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 40px;
      background: linear-gradient(145deg, #FF6B9E, #9C6AFF);
      border: 4px solid #fff;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      animation: gentle-bounce 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes gentle-bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .start-dialogue-box::after {
      content: '';
      position: absolute;
      top: 50%;
      right: -25px;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-top: 30px solid transparent;
      border-bottom: 30px solid transparent;
      border-left: 30px solid #9C6AFF;
    }

    #start-dialogue-text {
      font-size: 3rem;
      font-weight: 600;
      text-align: center;
      line-height: 1.4;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
    }

    .start-button-container {
      display: flex;
      justify-content: center;
    }

    .start-btn {
      min-width: 250px;
      padding: 25px 50px;
      border: none;
      border-radius: 60px;
      font-size: 3.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #fff;
      background: linear-gradient(145deg, #FFD166, #FF9F40);
      box-shadow: 
        0 8px 0px #E67E22,
        0 15px 30px rgba(0, 0, 0, 0.4),
        inset 0 2px 0px rgba(255, 255, 255, 0.3);
      text-shadow: 0px 2px 4px rgba(0, 0, 0, 0.3);
      animation: pulse-start 2s ease-in-out infinite;
    }

    @keyframes pulse-start {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .start-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 
        0 12px 0px #E67E22,
        0 20px 40px rgba(0, 0, 0, 0.5),
        inset 0 2px 0px rgba(255, 255, 255, 0.4);
      animation: none;
    }

    .start-btn:active {
      transform: translateY(4px) scale(1.02);
      box-shadow: 
        0 4px 0px #E67E22,
        0 8px 15px rgba(0, 0, 0, 0.4),
        inset 0 2px 0px rgba(255, 255, 255, 0.2);
    }

    /* --- general screen & panel layout --- */
    .content-screen {
      display: none;
      flex-direction: row;
      align-items: stretch;
      justify-content: center;
      width: 100%;
      height: 100%;
      position: relative;
    }

    .content-screen.active {
      display: flex;
    }

    .interactive-pane {
      flex: 2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 20px;
    }

    .results-pane {
      flex: 1;
      background-color: rgba(0, 0, 0, 0.1);
      border-left: 2px solid #3a3a3a;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* intrective pannel components */
    .wizard-container {
      position: absolute;
      left: 0px;
      bottom: 80px;
      transform: scaleX(-1);
    }

    #wizard-char {
      height: 468px;
      user-select: none;
    }

    /* dialouge box styling */

    .dialogue-box {
      position: absolute;
      left: 130px;
      top: 180px;
      padding: 40px 40px;
      border-radius: 30px;
      width: 90%;
      max-width: 800px;
      margin-top: -120px;
      z-index: 10;
      height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 24px;
      transition: background-color 0.4s ease, border-color 0.4s ease;

      /* default theme (grey) */
      background-color: #4a4a52;
      border: 1px solid #6c6c75;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .dialogue-box::after {
      content: '';
      position: absolute;
      bottom: -18px;
      left: 80px;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 20px solid #4a4a52;
    }

    #dialogue-text {
      font-size: 2.5rem;
      font-weight: 500;
      text-align: center;
      line-height: 1.4;
      color: #fff;
      padding-bottom: 10px;
    }

    .dialogue-buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    .dialogue-btn {
      min-width: 180px;
      padding: 18px 35px;
      border: none;
      border-radius: 50px;
      font-size: 2.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
      background: linear-gradient(145deg, #fdbe35, #fba92d);
      box-shadow: 0 6px 0px #b57a0b, 0 8px 15px rgba(0, 0, 0, 0.3);
      text-shadow: 0px 1px 2px rgba(0, 0, 0, 0.4);
    }

    .dialogue-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 0px #b57a0b, 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .dialogue-btn:active:not(:disabled) {
      transform: translateY(4px);
      box-shadow: 0 2px 0px #b57a0b, 0 4px 8px rgba(0, 0, 0, 0.4);
    }

    /* --- next style --- */

    .dialogue-btn.next-style {
      background: linear-gradient(to top, #4CAF50, #81C784);
      box-shadow: 0 6px 0 0 #2E7D32, 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .dialogue-btn.next-style:hover:not(:disabled) {
      box-shadow: 0 9px 0 0 #2E7D32, 0 12px 25px rgba(0, 0, 0, 0.25);
    }

    .dialogue-btn.next-style:active:not(:disabled) {
      box-shadow: 0 3px 0 0 #2E7D32, 0 6px 10px rgba(0, 0, 0, 0.2);
    }

    /* --- retry style --- */

    .dialogue-btn.retry-style {
      background: linear-gradient(to top, #d32f2f, #f44336);
      box-shadow: 0 6px 0 0 #b71c1c, 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .dialogue-btn.retry-style:hover:not(:disabled) {
      box-shadow: 0 9px 0 0 #b71c1c, 0 12px 25px rgba(0, 0, 0, 0.25);
    }

    .dialogue-btn.retry-style:active:not(:disabled) {
      box-shadow: 0 3px 0 0 #b71c1c, 0 6px 10px rgba(0, 0, 0, 0.2);
    }

    /* --- summary style --- */

    .dialogue-btn.summary-style.active {
      background: linear-gradient(to top, #ab6aff, #8648ff);
      box-shadow: 0 6px 0 0 #6333c4, 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .dialogue-btn.summary-style.active:hover:not(:disabled) {
      box-shadow: 0 9px 0 0 #6333c4, 0 12px 25px rgba(0, 0, 0, 0.25);
    }

    .dialogue-btn.summary-style.active:active:not(:disabled) {
      box-shadow: 0 3px 0 0 #6333c4, 0 6px 10px rgba(0, 0, 0, 0.2);
    }

    /* dialogue box themes */
    .dialogue-box.correct {
      background-color: #1b5e20;
      /* border-color: #e8f5e9; */
    }

    .dialogue-box.correct::after {
      border-top: 20px solid #1b5e20;
    }

    .dialogue-box.correct #dialogue-text {
      color: #a5d6a7;
    }

    .dialogue-box.incorrect {
      background-color: #b71c1c;
      /* border-color: #ffebee; */
    }

    .dialogue-box.incorrect::after {
      border-top: 20px solid #b71c1c;
    }

    .dialogue-box.incorrect #dialogue-text {
      color: #ef9a9a;
    }

    /* number grid styling */
    .number-grid-container {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .number-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 10px;
      width: 100%;
      max-width: 900px;
      user-select: none;
    }

    .grid-cell {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      aspect-ratio: 1 / 1;
      background-color: rgba(255, 255, 255, 0.04);
      outline: 4px solid #444;
      border-radius: 12px;
      font-size: 2.6rem;
      font-weight: 600;
      color: #ccc;
      transition: all 0.3s ease-in-out;
      padding: 0 4px;
      cursor: pointer;
    }

    .grid-cell:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
    }

    /* text highlight */
    span.highlight.purple {
      color: #9c6aff;
      text-shadow: 0 0 20px rgba(156, 106, 255, 0.7);
    }

    span.highlight.red {
      color: #e57373;
      text-shadow: 0 0 20px rgba(229, 115, 115, 0.7);
    }

    span.highlight.green {
      color: #4CAF50;
      text-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
    }

    span.highlight.pink {
      color: #FF6B9E;
      text-shadow: 0 0 20px rgba(255, 107, 158, 0.7);
    }

    /* grid cell styling */

    /* --- crossed out ---  */
    .grid-cell[data-status="crossed-out"] {
      background-color: rgba(229, 115, 115, 0.1);
      border-color: transparent;
      cursor: default;
    }

    .grid-cell[data-status="crossed-out"] .number-text {
      opacity: 0.3;
    }

    .grid-cell[data-status="crossed-out"]::after {
      content: '✗';
      position: absolute;
      font-size: 4rem;
      color: #e57373;
      opacity: 0.8;
      line-height: 1;
    }

    /* --- composit ---  */
    .grid-cell[data-status="composit"] {
      border-radius: 100%;
      outline: 4px solid #9c6aff;
      color: #c5a8ff;
      background-color: rgba(156, 106, 255, 0.2);
      box-shadow: 0 0 20px rgba(156, 106, 255, 0.7);
    }

    /* --- neither ---  */
    .grid-cell[data-status="neither"] {
      outline: 4px solid #e57373;
      color: #ffcdd2;
      background-color: rgba(229, 115, 115, 0.2);
      box-shadow: 0 0 20px rgba(229, 115, 115, 0.7);
    }

    /* --- prime ---  */
    .grid-cell[data-status="prime"] {
      outline: 4px solid #4CAF50;
      color: #a5d6a7;
      background-color: rgba(76, 175, 80, 0.2);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
    }

    /* --- focused ---  */
    .grid-cell[data-status="focused"] {
      outline: 4px solid #fdbe35;
      color: #ffe082;
      background-color: rgba(253, 190, 53, 0.2);
      box-shadow: 0 0 20px rgba(253, 190, 53, 0.7);
    }

    /* --- highlight (yellow) ---  */
    .grid-cell[data-status="highlight"] {
      outline: 4px solid #FFD700;
      color: #000;
      background-color: rgba(255, 215, 0, 0.8);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
      transition: all 0.3s ease;
    }

    .grid-cell[data-status="button"] {
      cursor: pointer;
      outline: 4px solid #FF6B9E;
      color: #ffd1ea;
      background-color: rgba(255, 107, 158, 0.2);
      box-shadow: 0 0 20px rgba(255, 107, 158, 0.7);
      animation: pulse-green 1.5s infinite;
    }

    @keyframes pulse-green {
      0% {
        transform: scale(1.0);
        box-shadow: 0 0 20px rgba(255, 107, 158, 0.4);
        z-index: 10;
      }

      50% {
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 107, 158, 0.9);
        z-index: 10;
      }

      100% {
        transform: scale(1.0);
        box-shadow: 0 0 20px rgba(255, 107, 158, 0.4);
        z-index: 10;
      }
    }
  </style>
</head>

<body>
  <!-- Top Marquee -->
  <div class="top-marquee">
    <div class="top-marquee-text">Temukan konten dan modul lengkap menggunakan PID, lewat aplikasi Teman Belajar</div>
  </div>

  <div class="scale-container">
    <div class="scale-wrapper">
      <div class="applet-canvas">
        <div class="applet-container">

          <!-- ======================= main content ======================= -->
          <div class="assets">
            <div class="workingArea-container">

              <!-- lang toggle -->
              <button id="langToggle">ID</button>

              <!-- working area -->
              <div class="workingArea">

                <!-- screen 0 - Start Screen -->
                <div class="content-screen active" id="screen0">
                  <img src="./assets/logo.png" alt="Logo" class="logo">
                  <div class="start-screen-container">
                    <div class="start-content-wrapper">
                      <!-- Welcome Speech Bubble -->
                      <div class="start-dialogue-box" id="start-dialogue-box">
                        <p id="start-dialogue-text">Hello! I am back.<br><br>Let's look at numbers and check if they are prime.<br><br>Click Start to begin.</p>
                        
                        <!-- Start Button -->
                        <div class="start-button-container">
                          <button class="start-btn" id="startButton">Start</button>
                        </div>
                      </div>

                      <!-- Wizard Character -->
                      <div class="start-wizard-container">
                        <img id="start-wizard-char" src="./assets/wizard-happy.png" alt="Wizard character">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- screen 1 -->
                <div class="content-screen" id="screen1">
                  <img src="./assets/logo.png" alt="Logo" class="logo">
                  <div class="interactive-pane">
                    <!-- Wizard Character -->
                    <div class="wizard-container">
                      <img id="wizard-char" src="./assets/wizard-happy.png" alt="Wizard character">
                    </div>

                    <!-- Dialogue Box (Speech Bubble) -->
                    <div class="dialogue-box" id="dialogue-box">
                      <p id="dialogue-text">Let's start with the first natural number - 1 - is it a prime?</p>

                      <!-- Container for Yes/No or Next buttons -->
                      <div class="dialogue-buttons" id="dialogue-options">
                        <button class="dialogue-btn" id="yesButton">Yes</button>
                        <button class="dialogue-btn" id="noButton">No</button>

                        <!-- feedback/instruction buttons -->
                        <button class="dialogue-btn next-style" id="nextStepButton" style="display: none;">Next</button>
                        <button class="dialogue-btn retry-style" id="retryButton" style="display: none;">Retry</button>

                        <!-- summary buttons -->
                        <button class="dialogue-btn summary-style" id="primeButton"
                          style="display: none;">Prime</button>
                        <button class="dialogue-btn summary-style" id="compositButton"
                          style="display: none;">Composit</button>
                        <button class="dialogue-btn summary-style" id="neitherButton"
                          style="display: none;">Neither</button>
                      </div>
                    </div>
                  </div>
                  <div class="results-pane">
                    <div class="number-grid-container">
                      <div class="number-grid" id="numberGrid">
                        <!-- generated by js -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ======================= navigation ======================= -->
              <!-- <div class="lowerControls">
                <div class="navigation">
                  <button class="nav-btn" id="prevButton" disabled>Previous</button>
                </div>
              </div> -->

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // ====================== state & config ======================
    // ============================================================
    let currentStep = 0;
    let subStep = 'question'; // 'question', 'feedback_correct', 'feedback_incorrect', 'sieve'
    let lang = 'id'; // Set default language to Indonesian
    const prime_numbers = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97];

    const wizardImages = {
      happy: './assets/wizard-happy.png',
      sad: './assets/wizard-sad.png',
      clap: './assets/wizard-clap.png'
    };

    const gridNumbers = Array.from({ length: 100 }, (_, i) => ({
      value: i + 1,
      status: 'default' // 'default', 'crossed-out', 'composit', 'neither', 'prime', 'focused'
    }));

    const langText = {
      en: {
        startScreen: {
          text: 'Hello! I am back.<br><br>Let\'s look at numbers and check if they are prime.<br><br>Click Start to begin.',
          button: 'Start'
        },
        buttons: {
          yes: 'Yes',
          no: 'No',
          retry: 'Try Again',
          next: 'Next',
          previous: 'Previous',
          prime: 'Prime',
          composit: 'Composite',
          neither: 'Neither',
        },
        actions: {
          prime: `Numbers divisible ONLY by 1 and the number itself. Marked with <span class="highlight green">green</span>.`,
          composit: `Numbers divisible by 1, the number itself, and other factors. Marked with <span class="highlight purple">purple</span>.`,
          neither: `1 is neither prime nor composite because it is divisible by only 1 marked with <span class="highlight red">red</span>.`
        },
        steps: [
          {
            type: 'number',
            number: 1,
            is_prime: null,
            correct_choice: 'no',
            question: `Let's start with the first natural number - 1 - is it a prime?`,
            feedback: {
              incorrect: `Think again! 1 is divisible only by itself.`,
              correct: `Correct! 1 is neither prime nor composite because it is divisible only by 1. So, cross it out.`
            },
            sieve_instruction: 'null',
          },
          {
            type: 'number',
            number: 2,
            is_prime: true,
            correct_choice: 'yes',
            question: `What about 2 - is it a prime?`,
            feedback: {
              incorrect: `Think again! 2 is divisible only by 1 and itself.`,
              correct: `Correct! 2 is divisible only by 1 and itself.\n\nFact: 2 is the only even prime number.`
            },
            sieve_instruction: `All bigger multiples of a prime number are composite numbers.\n\n<span class="highlight pink">Tap</span> on 2 to cross them out.`
          },
          {
            type: 'info',
            instruction: `Look! Only half of the numbers are left now on the grid.`
          },
          {
            type: 'number',
            number: 3,
            is_prime: true,
            correct_choice: 'yes',
            question: `Now, 3 - is it a prime?`,
            feedback: {
              incorrect: `Think again! 3 is divisible only by 1 and itself.`,
              correct: `Correct! 3 is divisible only by 1 and itself.`
            },
            sieve_instruction: `<span class="highlight pink">Tap</span> on 3 to cross out all bigger multiples of 3. They are composite numbers.`
          },
          {
            type: 'info',
            instruction: `Wow! There are even fewer numbers left on the grid.`
          },
          {
            type: 'number',
            number: 5,
            is_prime: true,
            correct_choice: 'yes',
            question: `Next number 5 — is it a prime?`,
            feedback: {
              incorrect: `Think again! 5 is divisible only by 1 and itself.`,
              correct: `Correct! 5 is divisible only by 1 and itself.`
            },
            sieve_instruction: `<span class="highlight pink">Tap</span> on 5 to cross out all bigger multiples of 5. They are composite numbers.`
          },
          {
            type: 'info',
            instruction: `Yay! Just a small group of numbers remain.`
          },
          {
            type: 'number',
            number: 7,
            is_prime: true,
            correct_choice: 'yes',
            question: `Lastly, 7 — is it a prime?`,
            feedback: {
              incorrect: `Think again! 7 is divisible only by 1 and itself.`,
              correct: `Correct! 7 is divisible only by 1 and itself.`
            },
            sieve_instruction: `<span class="highlight pink">Tap</span> on 7 to cross out all bigger multiples of 7. They are composite numbers.`
          },
          {
            type: 'info',
            instruction: `Yay! We're done! The numbers that are left on the grid are the prime numbers.`
          },
          {
            type: 'grid',
            grid_method: 'mark_prime',
            instruction: `Here are the prime numbers up to 100 marked with <span class="highlight green">green</span>.`
          },
          {
            type: 'grid',
            grid_method: 'mark_composit',
            instruction: `Numbers that are not prime (except 1) are composite numbers marked in <span class="highlight purple">purple</span>.`
          },
          {
            type: 'summary',
            title: 'Summary',
            instruction: `Tap a button to Explore the numbers.`,
          },
        ],
      },
      id: {
        startScreen: {
          text: 'Halo! Saya kembali<br><br>Mari kita lihat beberapa bilangan dan periksa apakah bilangan tersebut adalah bilangan prima.<br><br>Ketuk \'Mulai\' untuk memulai.',
          button: 'Mulai'
        },
        buttons: {
          yes: 'Ya',
          no: 'Tidak',
          retry: 'Coba Lagi',
          next: 'Berikutnya',
          previous: 'Sebelumnya',
          prime: 'Prima',
          composit: 'Komposit',
          neither: 'Lainnya',
        },
        actions: {
          prime: `Bilangan yang hanya dapat dibagi oleh 1 dan dirinya sendiri ditandai dengan warna <span class="highlight green">hijau</span>.`,
          composit: `Bilangan yang dapat dibagi oleh 1, dirinya sendiri, dan bilangan lain ditandai dengan warna <span class="highlight blue">biru</span>.`,
          neither: `1 bukan prima maupun komposit karena hanya dapat dibagi oleh 1, ditandai dengan warna <span class="highlight red">merah</span>.`
        },
        steps: [
          {
            type: 'number',
            number: 1,
            is_prime: null,
            correct_choice: 'no',
            question: `Mari kita mulai dengan bilangan pertama - 1 - apakah ini bilangan prima?`,
            feedback: {
              incorrect: `Pikirkan lagi! 1 hanya dapat dibagi oleh dirinya sendiri.`,
              correct: `Benar! 1 bukan prima maupun komposit karena hanya dapat dibagi oleh 1. Jadi, coretlah.`
            },
            sieve_instruction: 'null',
          },
          {
            type: 'number',
            number: 2,
            is_prime: true,
            correct_choice: 'yes',
            question: `Bagaimana dengan 2 - apakah ini bilangan prima?`,
            feedback: {
              incorrect: `Pikirkan lagi! 2 hanya dapat dibagi oleh 1 dan dirinya sendiri.`,
              correct: `Benar! 2 hanya dapat dibagi oleh 1 dan dirinya sendiri.\n\nFakta: 2 adalah satu-satunya bilangan prima genap.`
            },
            sieve_instruction: `Semua kelipatan yang lebih besar dari suatu bilangan prima adalah bilangan komposit.\n\n<span class="highlight pink">Ketuk</span> bilangan 2 untuk mencoret semua kelipatannya.`
          },
          {
            type: 'info',
            instruction: `Lihatlah bilangan-bilangan yang masih tersisa di tabel!`
          },
          {
            type: 'number',
            number: 3,
            is_prime: true,
            correct_choice: 'yes',
            question: `Sekarang, 3 - apakah ini bilangan prima?`,
            feedback: {
              incorrect: `Pikirkan lagi! Satu-satunya pembagi dari 3 adalah 1 dan 3.`,
              correct: `Benar! Satu-satunya pembagi dari 3 adalah 1 dan 3.`
            },
            sieve_instruction: `<span class="highlight pink">Ketuk</span> bilangan 3 untuk mencoret semua kelipatannya yang lebih besar. Mereka adalah bilangan komposit.`
          },
          {
            type: 'info',
            instruction: `Wah! Sekarang bilangan yang belum ditandai semakin sedikit.`
          },
          {
            type: 'number',
            number: 5,
            is_prime: true,
            correct_choice: 'yes',
            question: `Berikutnya bilangan 5 — apakah ini bilangan prima?`,
            feedback: {
              incorrect: `Pikirkan lagi! 5 hanya dapat dibagi oleh 1 dan dirinya sendiri.`,
              correct: `Benar! 5 hanya dapat dibagi oleh 1 dan dirinya sendiri.`
            },
            sieve_instruction: `<span class="highlight pink">Ketuk</span> bilangan 5 untuk mencoret semua kelipatannya yang lebih besar. Mereka adalah bilangan komposit.`
          },
          {
            type: 'info',
            instruction: `Hore! Hanya tersisa sekelompok kecil bilangan.`
          },
          {
            type: 'number',
            number: 7,
            is_prime: true,
            correct_choice: 'yes',
            question: `Terakhir, 7 — apakah ini bilangan prima?`,
            feedback: {
              incorrect: `Pikirkan lagi! 7 hanya dapat dibagi oleh 1 dan dirinya sendiri.`,
              correct: `Benar! 7 hanya dapat dibagi oleh 1 dan dirinya sendiri.`
            },
            sieve_instruction: `<span class="highlight pink">Ketuk</span> bilangan 7 untuk mencoret semua kelipatannya yang lebih besar. Mereka adalah bilangan komposit.`
          },
          {
            type: 'info',
            instruction: `Hore! Kita sudah selesai! Bilangan-bilangan yang masih terlihat adalah bilangan prima.`
          },
          {
            type: 'grid',
            grid_method: 'mark_prime',
            instruction: `Bilangan-bilangan yang tersisa ditandai dengan warna <span class="highlight green">hijau</span> untuk menunjukkan bilangan prima.`
          },
          {
            type: 'grid',
            grid_method: 'mark_composit',
            instruction: `Bilangan yang bukan prima (kecuali 1) adalah bilangan komposit yang ditandai dengan warna <span class="highlight purple">ungu</span>.`
          },
          {
            type: 'summary',
            title: 'Ringkasan',
            instruction: `Ketuk tombol untuk Menjelajahi bilangan-bilangan.`,
          },
        ],
      }
    }

    // SOUND EFFECTS

    // Global audio context - initialized on first user interaction
    let globalAudioContext = null;
    let audioInitialized = false;

    // Initialize audio context on first user interaction
    function initializeAudio() {
      if (audioInitialized) return true;
      
      try {
        globalAudioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Resume context if it's suspended (required by some browsers)
        if (globalAudioContext.state === 'suspended') {
          globalAudioContext.resume();
        }
        
        audioInitialized = true;
        console.log('Audio initialized successfully');
        return true;
      } catch (e) {
        console.error('Failed to initialize audio:', e);
        return false;
      }
    }

    // Enhanced audio function with better error handling
    function playSound(frequency, duration = 200, type = 'sine', volume = 0.1) {
      try {
        // Initialize audio if not already done
        if (!initializeAudio()) {
          console.log('Audio initialization failed');
          return;
        }

        // Check if context is available and not closed
        if (!globalAudioContext || globalAudioContext.state === 'closed') {
          console.log('Audio context not available');
          return;
        }

        // Resume context if suspended
        if (globalAudioContext.state === 'suspended') {
          globalAudioContext.resume();
        }

        const oscillator = globalAudioContext.createOscillator();
        const gainNode = globalAudioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(globalAudioContext.destination);
        
        oscillator.frequency.setValueAtTime(frequency, globalAudioContext.currentTime);
        oscillator.type = type;
        
        gainNode.gain.setValueAtTime(volume, globalAudioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, globalAudioContext.currentTime + duration / 1000);
        
        oscillator.start(globalAudioContext.currentTime);
        oscillator.stop(globalAudioContext.currentTime + duration / 1000);
        
        console.log(`Playing sound: ${frequency}Hz, ${duration}ms, ${type}, volume: ${volume}`);
      } catch (e) {
        console.error('Error playing sound:', e);
      }
    }
    
    function playClickSound() {
      console.log('Playing click sound');
      playSound(600, 40, 'sine', 0.15);
      setTimeout(() => playSound(800, 20, 'sine', 0.1), 40);
    }
    
    function playCorrectSound() {
      console.log('Playing correct sound');
      playSound(784, 80, 'triangle', 0.2);
      setTimeout(() => playSound(988, 80, 'triangle', 0.2), 80);
      setTimeout(() => playSound(1319, 200, 'triangle', 0.25), 160);
      
      setTimeout(() => {
        for (let i = 0; i < 4; i++) {
          setTimeout(() => {
            playSound(1500 + (i * 200), 60, 'triangle', 0.15);
          }, i * 60);
        }
      }, 360);
    }
    
    function playIncorrectSound() {
      console.log('Playing incorrect sound');
      playSound(392, 100, 'sine', 0.2);
      setTimeout(() => playSound(330, 300, 'sine', 0.25), 100);
      setTimeout(() => playSound(349, 80, 'sine', 0.15), 400);
    }

    function playPopSound() {
      console.log('Playing pop sound');
      try {
        // Use the global audio context
        if (!initializeAudio()) {
          console.log('Pop sound: Audio initialization failed');
          return;
        }

        if (!globalAudioContext || globalAudioContext.state === 'closed') {
          console.log('Pop sound: Audio context not available');
          return;
        }

        // Resume context if suspended
        if (globalAudioContext.state === 'suspended') {
          globalAudioContext.resume();
        }

        const oscillator = globalAudioContext.createOscillator();
        const gainNode = globalAudioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(globalAudioContext.destination);

        oscillator.type = 'triangle';
        oscillator.frequency.setValueAtTime(600, globalAudioContext.currentTime);
        gainNode.gain.setValueAtTime(0.3, globalAudioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, globalAudioContext.currentTime + 0.1);

        oscillator.start(globalAudioContext.currentTime);
        oscillator.stop(globalAudioContext.currentTime + 0.1);
      } catch (e) {
        console.error('Error playing pop sound:', e);
      }
    }

    // Test function to verify audio is working
    function testAudio() {
      console.log('Testing audio...');
      playClickSound();
    }

    // ===========================================================
    // ====================== initilization ======================
    // ===========================================================
    function initializeApplet() {
      console.log('Initializing Applet...');
      calculateScale();
      updateStartScreen();
      // setupNavigation();
      setupEventListeners();
      renderGrid();
      updateUI();
    }

    function setupEventListeners() {
      window.addEventListener('resize', calculateScale);

      // Language toggle functionality removed - button is hidden and language is fixed to Indonesian
      // let langToggle = document.getElementById('langToggle')
      // langToggle.addEventListener('click', () => {
      //   lang = (lang === 'en') ? 'id' : 'en';
      //   langToggle.textContent = (lang == 'en') ? 'ID' : 'EN';
      //   updateStartScreen();
      //   updateUI();
      // });

      const yesBtn = document.getElementById('yesButton');
      const noBtn = document.getElementById('noButton');
      const nextStepBtn = document.getElementById('nextStepButton');
      const retryBtn = document.getElementById('retryButton');
      const primeBtn = document.getElementById('primeButton');
      const compositBtn = document.getElementById('compositButton');
      const neitherBtn = document.getElementById('neitherButton');
      const dialogueText = document.getElementById('dialogue-text');
      const startBtn = document.getElementById('startButton');

      // Start button functionality
      startBtn.addEventListener('click', () => {
        playClickSound();
        document.getElementById('screen0').classList.remove('active');
        document.getElementById('screen1').classList.add('active');
      });

      const handleChoice = (choice) => {
        playClickSound();
        const stepData = langText[lang].steps[currentStep];
        if (choice === stepData.correct_choice) {
          subStep = 'feedback_correct';
          // Play correct sound after a brief delay to let the click sound finish
          setTimeout(() => playCorrectSound(), 100);
        } else {
          subStep = 'feedback_incorrect';
          // Play incorrect sound after a brief delay to let the click sound finish
          setTimeout(() => playIncorrectSound(), 100);
        }
        updateUI();
      };

      yesBtn.addEventListener('click', () => handleChoice('yes'));
      noBtn.addEventListener('click', () => handleChoice('no'));

      retryBtn.addEventListener('click', handleRetryClick);
      nextStepBtn.addEventListener('click', handleNextClick);

      primeBtn.addEventListener('click', () => {
        handlePrimeClick();
        dialogueText.innerHTML = langText[lang].actions['prime'];
        primeBtn.classList.add('active');
        compositBtn.classList.remove('active');
        neitherBtn.classList.remove('active');
      });

      compositBtn.addEventListener('click', () => {
        handleCompositClick();
        dialogueText.innerHTML = langText[lang].actions['composit'];
        primeBtn.classList.remove('active');
        compositBtn.classList.add('active');
        neitherBtn.classList.remove('active');
      });

      neitherBtn.addEventListener('click', () => {
        handleNeitherClick();
        dialogueText.innerHTML = langText[lang].actions['neither'];
        primeBtn.classList.remove('active');
        compositBtn.classList.remove('active');
        neitherBtn.classList.add('active');
      });
    }

    function handleRetryClick() {
      playClickSound();
      subStep = 'question';
      updateUI();
    }

    function handleNextClick() {
      playClickSound();
      console.log('handle next click:', subStep);
      if (subStep === 'sieve' || currentStep == 0) {
        currentStep++;
        subStep = 'question';
      } else {
        subStep = 'sieve';
      }
      updateUI();
    }

    function handlePrimeClick() {
      playClickSound();
      updateCell(1, 'default');
      for (let i = 2; i <= 100; i++) {
        if (prime_numbers.includes(i)) {
          updateCell(i, 'prime');
        } else {
          updateCell(i, 'default');
        }
      }
      updateGrid();
    }

    function handleCompositClick() {
      playClickSound();
      updateCell(1, 'default');
      for (let i = 2; i <= 100; i++) {
        if (!prime_numbers.includes(i)) {
          updateCell(i, 'composit');
        } else {
          updateCell(i, 'default');
        }
      }
      updateGrid();
    }

    function handleNeitherClick() {
      playClickSound();
      updateCell(1, 'neither');
      for (let i = 2; i <= 100; i++) {
        updateCell(i, 'default');
      }
      updateGrid();
    }

    function handleGridClick(value) {
      if (subStep !== 'sieve') return;

      const stepData = langText[lang].steps[currentStep];

      if (value !== stepData.number) return;

      updateCell(value, 'button');

      // Collect all multiples to be crossed
      const multiplesToCross = [];
      for (let i = value * 2; i <= 100; i += value) {
        if (gridNumbers[i - 1].status === 'default') {
          multiplesToCross.push(i);
        }
      }

      // Phase 1: Highlight all multiples immediately (yellow background)
      multiplesToCross.forEach(num => {
        updateCell(num, 'highlight');
      });
      updateGrid();

      // Phase 2: Remove highlight after 1.5 seconds (return to normal)
      setTimeout(() => {
        multiplesToCross.forEach(num => {
          updateCell(num, 'default');
        });
        updateGrid();

        // Phase 3: Cross out after additional 0.5 seconds (2 seconds total)
        setTimeout(() => {
          let delay = 0;
          const delayIncrement = 30;
          
          multiplesToCross.forEach(num => {
            setTimeout(() => {
              playPopSound(); 
              updateCell(num, 'crossed-out');
              updateGrid();
            }, delay);
            delay += delayIncrement;
          });
        }, 500);
      }, 1500);

      // Set the clicked number as prime and proceed to next step
      setTimeout(() => {
        updateCell(value, 'prime');
        subStep = 'sieve';
        handleNextClick();
      }, 2500);
    }

    function updateStartScreen() {
      const startDialogueText = document.getElementById('start-dialogue-text');
      const startButton = document.getElementById('startButton');
      
      startDialogueText.innerHTML = langText[lang].startScreen.text;
      startButton.textContent = langText[lang].startScreen.button;
    }

    function updateGrid() {
      gridNumbers.forEach(number => {
        const cell = document.querySelector(`.grid-cell[data-value="${number.value}"]`);
        cell.dataset.status = number.status;
      });
    }

    function updateCell(value, newStatus) {
      gridNumbers[value - 1].status = newStatus;

      const cell = document.querySelector(`.grid-cell[data-value="${value}"]`);
      if (cell) {
        cell.className = 'grid-cell';
        if (newStatus !== 'default') {
          cell.dataset.status = newStatus;
        }
      }
    }

    function updateUI() {
      const wizard = document.getElementById('wizard-char');
      const dialogueBox = document.getElementById('dialogue-box')
      const dialogueText = document.getElementById('dialogue-text');
      const dialogueOptions = document.getElementById('dialogue-options');
      const yesBtn = document.getElementById('yesButton');
      const noBtn = document.getElementById('noButton');
      const retryBtn = document.getElementById('retryButton');
      const nextStepBtn = document.getElementById('nextStepButton');
      const primeBtn = document.getElementById('primeButton');
      const compositBtn = document.getElementById('compositButton');
      const neitherBtn = document.getElementById('neitherButton');

      console.log(currentStep, langText[lang].steps.length);
      if (currentStep > langText[lang].steps.length) return;
      const stepData = langText[lang].steps[currentStep];

      const currentlyFocused = document.querySelector('.grid-cell[data-status="focused"]');
      if (currentlyFocused) {
        currentlyFocused.dataset.status = 'default';
      }

      // button text...
      yesBtn.textContent = langText[lang].buttons.yes;
      noBtn.textContent = langText[lang].buttons.no;
      retryBtn.textContent = langText[lang].buttons.retry;
      nextStepBtn.textContent = langText[lang].buttons.next;
      primeBtn.textContent = langText[lang].buttons.prime;
      compositBtn.textContent = langText[lang].buttons.composit;
      neitherBtn.textContent = langText[lang].buttons.neither;

      if (stepData.type === 'number') {
        if (subStep === 'question' || subStep === 'feedback_incorrect' || subStep === 'feedback_correct') {
          if (stepData.number === 1) {
            updateCell(stepData.number, 'neither');
          } else {
            updateCell(stepData.number, 'focused');
          }
        }

        switch (subStep) {
          case 'question':
            wizard.src = wizardImages.happy;
            dialogueText.innerHTML = stepData.question;
            yesBtn.style.display = 'inline-block';
            noBtn.style.display = 'inline-block';
            retryBtn.style.display = 'none';
            nextStepBtn.style.display = 'none';
            primeBtn.style.display = 'none';
            compositBtn.style.display = 'none';
            neitherBtn.style.display = 'none';
            dialogueBox.classList.remove('incorrect');
            dialogueBox.classList.remove('correct');
            break;

          case 'feedback_incorrect':
            wizard.src = wizardImages.sad;
            dialogueText.innerHTML = stepData.feedback.incorrect;
            yesBtn.style.display = 'none';
            noBtn.style.display = 'none';
            retryBtn.style.display = 'inline-block';
            nextStepBtn.style.display = 'none';
            primeBtn.style.display = 'none';
            compositBtn.style.display = 'none';
            neitherBtn.style.display = 'none';
            dialogueBox.classList.add('incorrect');
            break;

          case 'feedback_correct':
            wizard.src = wizardImages.clap;
            dialogueText.innerHTML = stepData.feedback.correct;
            yesBtn.style.display = 'none';
            noBtn.style.display = 'none';
            retryBtn.style.display = 'none';
            nextStepBtn.style.display = 'inline-block';
            primeBtn.style.display = 'none';
            compositBtn.style.display = 'none';
            neitherBtn.style.display = 'none';
            dialogueBox.classList.add('correct');

            if (currentStep === 0) { updateCell(1, 'crossed-out'); }
            break;

          case 'sieve':
            wizard.src = wizardImages.happy;
            dialogueText.innerHTML = stepData.sieve_instruction;
            yesBtn.style.display = 'none';
            noBtn.style.display = 'none';
            retryBtn.style.display = 'none';
            nextStepBtn.style.display = 'none';
            primeBtn.style.display = 'none';
            compositBtn.style.display = 'none';
            neitherBtn.style.display = 'none';
            dialogueBox.classList.remove('correct');
            dialogueBox.classList.remove('incorrect');

            updateCell(stepData.number, 'button');
            break;
        }

      } else if (stepData.type === 'info') {
        wizard.src = wizardImages.happy;
        dialogueText.innerHTML = stepData.instruction;
        yesBtn.style.display = 'none';
        noBtn.style.display = 'none';
        retryBtn.style.display = 'none';
        nextStepBtn.style.display = 'inline-block';
        primeBtn.style.display = 'none';
        compositBtn.style.display = 'none';
        neitherBtn.style.display = 'none';
        dialogueBox.classList.remove('correct');
        dialogueBox.classList.remove('incorrect');
        subStep = 'sieve';

      } else if (stepData.type === 'grid') {
        subStep = 'sieve';
        switch (stepData.grid_method) {
          case 'mark_prime':
            wizard.src = wizardImages.happy;
            dialogueText.innerHTML = stepData.instruction;
            yesBtn.style.display = 'none';
            noBtn.style.display = 'none';
            retryBtn.style.display = 'none';
            nextStepBtn.style.display = 'inline-block';
            primeBtn.style.display = 'none';
            compositBtn.style.display = 'none';
            neitherBtn.style.display = 'none';
            dialogueBox.classList.remove('correct');
            dialogueBox.classList.remove('incorrect');

            prime_numbers.forEach(number => { updateCell(number, 'prime'); });
            break;

          case 'mark_composit':
            wizard.src = wizardImages.happy;
            dialogueText.innerHTML = stepData.instruction;
            yesBtn.style.display = 'none';
            noBtn.style.display = 'none';
            retryBtn.style.display = 'none';
            nextStepBtn.style.display = 'inline-block';
            primeBtn.style.display = 'none';
            compositBtn.style.display = 'none';
            neitherBtn.style.display = 'none';
            dialogueBox.classList.remove('correct');
            dialogueBox.classList.remove('incorrect');

            for (let number = 2; number <= 100; number++) {
              if (!prime_numbers.includes(number)) { updateCell(number, 'composit'); }
              else { updateCell(number, 'default'); }
            }
            break;
        }

      } else if (stepData.type === 'summary') {
        wizard.src = wizardImages.happy;
        dialogueText.innerHTML = stepData.instruction;
        yesBtn.style.display = 'none';
        noBtn.style.display = 'none';
        retryBtn.style.display = 'none';
        nextStepBtn.style.display = 'none';
        primeBtn.style.display = 'inline-block';
        compositBtn.style.display = 'inline-block';
        neitherBtn.style.display = 'inline-block';
        dialogueBox.classList.remove('correct');
        dialogueBox.classList.remove('incorrect');

        for (let number = 1; number <= 100; number++) {
          updateCell(number, 'default');
        }
      }

      // update the grid
      updateGrid();
    }

    // ======================================================
    // ====================== ui setup ======================
    // ======================================================

    // function setupNavigation() {
    //   const nextBtn = document.getElementById('nextButton');

    //   // add event listners
    //   prevBtn.addEventListener('click', () => switchToScreen(currentScreen - 1));
    // }

    function renderGrid() {
      const gridContainer = document.getElementById('numberGrid');
      gridContainer.innerHTML = '';

      gridNumbers.forEach(num => {
        const cell = document.createElement('div');
        cell.className = 'grid-cell';
        cell.dataset.value = num.value;
        cell.dataset.status = num.status;

        const numberText = document.createElement('span');
        numberText.className = 'number-text';
        numberText.textContent = num.value;

        cell.appendChild(numberText);

        cell.addEventListener('click', () => handleGridClick(num.value));

        gridContainer.appendChild(cell);
      });
    }

    // =============================================================
    //====================== helper functions ======================
    // =============================================================

    function calculateScale() {
      const container = document.querySelector('.scale-container');
      const wrapper = document.querySelector('.scale-wrapper');
      const scaleX = container.clientWidth / 1920;
      const scaleY = container.clientHeight / 1080;
      const scale = Math.min(scaleX, scaleY);
      wrapper.style.transform = `scale(${scale})`;
    }

    // starting applet 
    document.addEventListener('DOMContentLoaded', initializeApplet);
  </script>
</body>

</html>
