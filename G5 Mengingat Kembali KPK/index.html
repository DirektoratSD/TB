<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Burgy & Mathy's Park Trip</title>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /*
     * ==================================================================
     * ====================== global & reset style ======================
     * ==================================================================
    */
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family: 'Comfortaa', 'Segoe UI', sans-serif;
    }

    body {
      background-color: #121212;
      color: #e0e0e0;
      overflow: hidden;
    }

    /*
     * ===============================================================
     * ====================== layout  & scaling ======================
     * ===============================================================
    */
    .scale-container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      background-color: #121212;
    }

    .scale-wrapper {
      transform-origin: center;
    }

    .applet-canvas {
      width: 1920px;
      height: 1080px;
      position: relative;
    }

    .applet-container {
      width: 1920px;
      height: 1080px;
      display: flex;
      flex-direction: column;
      margin: 0 auto;
      overflow: hidden;
      background-color: #121212;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      position: relative;
    }

    .marquee {
      position: fixed;
      top: 0;
      left: 140px;
      right: 0;
      height: 4vh;
      background-color: rgba(0, 0, 0, 0.35);
      color: white;
      display: flex;
      align-items: center;
      overflow: hidden;
      z-index: 999;
      pointer-events: none;
    }

    .marquee-content {
      position: absolute;
      white-space: nowrap;
      animation: marquee-scroll 20s linear infinite;
      font-size: 1.5rem;
      font-weight: 500;
      padding-right: 20px;
    }

    @keyframes marquee-scroll {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    .logo {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 1001;
      width: 120px;
      height: auto;
      pointer-events: none;
      object-fit: contain;
      /* Logo scales automatically with the scale-wrapper transform */
    }

    /* Additional responsive adjustments for very small screens */
    @media (max-width: 768px) {
      .logo {
        width: 80px;
        top: 10px;
        left: 10px;
      }
      .marquee {
        left: 90px;
      }
    }

    @media (max-width: 480px) {
      .logo {
        width: 60px;
        top: 8px;
        left: 8px;
      }
      .marquee {
        left: 68px;
      }
    }

    .assets {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      overflow: hidden;
    }

    .workingArea-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      background-color: #1a1a1a;
      overflow: hidden;
    }

    .workingArea {
      flex: 1;
      border: 3px solid #FF6B9E;
      border-radius: 16px;
      background-color: #222222;
      box-shadow: 0 0 15px rgba(255, 107, 158, 0.3);
      margin: 8px 0;
      position: relative;
      display: flex;
      padding: 0;
      height: 100%;
    }

    /*
     * ================================================================
     * ====================== core ui components ======================
     * ================================================================
    */
    .instruction {
      position: relative;
      text-align: center;
      font-size: 2.2rem;
      font-weight: 600;
      margin: 10px 0;
      color: #FFD166;
      padding: 20px;
      background-color: rgba(255, 209, 102, 0.1);
      border-radius: 12px;
    }

    #langToggle {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        right: 20px;
        background: #fff;
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 2rem;
        font-weight: 600;
        color: #FF6B9E;
        display: none; /* Hide the language toggle button */
    }

    span.focus {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
    }

    .lowerControls {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      padding: 16px 24px;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .nav-btn {
      min-height: 60px;
      padding: 12px 32px;
      margin: 0 10px;
      border: none;
      border-radius: 50px;
      font-size: 2rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
      background: linear-gradient(145deg, #fdbe35, #fba92d);
      box-shadow:
        0 20px 20px rgba(251, 169, 45, 0.3),
        inset 0 2px 1px rgba(255, 255, 255, 0.5),
        inset 0 -2px 3px rgba(0, 0, 0, 0.1),
        0 4px 0px rgba(206, 141, 0, 0.6);
      text-shadow: 0px 1px 2px rgba(175, 144, 5, 0.89);
    }

    .nav-btn:hover:not(:disabled) {
      transform: translateY(-2px);
    }

    .nav-btn:active:not(:disabled) {
      background: linear-gradient(145deg, #fba92d, #f9a825);
      box-shadow: 0 4px 8px rgba(251, 155, 45, 0.3), inset 0 2px 3px rgba(0, 0, 0, 0.3);
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      background: #666;
    }

    .progress-container {
      display: flex;
      flex-direction: row;
      gap: 8px;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background-color: #ffc107;
      transform: scale(1.25);
      box-shadow: 0 0 5px #ffc107;
    }

    .progress-dot.completed {
      background-color: #4CAF50;
    }

    /*
     * ====================================================================
     * ====================== screen specific styles ======================
     * ====================================================================
    */
    .content-screen {
      display: none;
      width: 100%;
      height: 100%;
      position: relative;
    }

    .content-screen.active {
      display: block;
    }

    .interactive-pane {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      position: relative;
      padding: 20px;
      width: 100%;
      height: 100%;
    }

    /* number lines */
    .frame-container {
      width: 90%;
      height: 500px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 52px;
    }

    .frame-container img.number-line-base {
      width: 100%;
      object-fit: cover;
      object-position: center;
    }
    
    /* generation area */
    .generation-area {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .burgy-day, .mathy-day {
      position: absolute;
      width: 102px;
      aspect-ratio: 1 / 1;
      background-position: center;
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0;
      transition: opacity 0.2s ease-in-out, background-image 0.1s ease;
      z-index: 2;
    }

    .burgy-day.active, .mathy-day.active {
      opacity: 1;
    }

    /* Original positions for Screens 1 & 2 */
    .burgy-day[data-value="2"]  { top: 134px; left: 206px; background-image: url('./assets/Burgy/2.png'); }
    .burgy-day[data-value="4"]  { top: 134px; left: 346px; background-image: url('./assets/Burgy/4.png'); }
    .burgy-day[data-value="6"]  { top: 134px; left: 490px; background-image: url('./assets/Burgy/6.png'); }
    .burgy-day[data-value="8"]  { top: 134px; left: 630px; background-image: url('./assets/Burgy/8.png'); }
    .burgy-day[data-value="10"] { top: 134px; left: 770px; background-image: url('./assets/Burgy/10.png'); }
    .burgy-day[data-value="12"] { top: 134px; left: 910px; background-image: url('./assets/Burgy/12.png'); }
    .burgy-day[data-value="14"] { top: 134px; left: 1052px; background-image: url('./assets/Burgy/14.png'); }
    .burgy-day[data-value="16"] { top: 134px; left: 1190px; background-image: url('./assets/Burgy/16.png'); }
    .burgy-day[data-value="18"] { top: 134px; left: 1330px; background-image: url('./assets/Burgy/18.png'); }
    .burgy-day[data-value="20"] { top: 134px; left: 1474px; background-image: url('./assets/Burgy/20.png'); }

    .mathy-day[data-value="3"]  { top: 134px; left: 278px; background-image: url('./assets/Mathy/3.png'); }
    .mathy-day[data-value="6"]  { top: 134px; left: 492px; background-image: url('./assets/Mathy/6.png'); }
    .mathy-day[data-value="9"]  { top: 134px; left: 708px; background-image: url('./assets/Mathy/9.png'); }
    .mathy-day[data-value="12"] { top: 134px; left: 912px; background-image: url('./assets/Mathy/12.png'); }
    .mathy-day[data-value="15"] { top: 134px; left: 1122px; background-image: url('./assets/Mathy/15.png'); }
    .mathy-day[data-value="18"] { top: 134px; left: 1336px; background-image: url('./assets/Mathy/18.png'); }

    /* Overriding positions ONLY for Screen 3 */
    #screen3 .mathy-day { 
        top: 80px; 
        pointer-events: auto;
        cursor: pointer;
    }
    #screen3 .burgy-day { 
        top: 200px; 
        pointer-events: auto;
        cursor: pointer;
    }

    /* screen 3 positions & images */
    #screen3 .burgy-day[data-value="2"]  { left: 186px; background-image: url('./assets/Both/2.png'); }
    #screen3 .burgy-day[data-value="4"]  { left: 340px; background-image: url('./assets/Both/4.png'); }
    #screen3 .burgy-day[data-value="6"]  { left: 494px; background-image: url('./assets/Both/6.png'); }
    #screen3 .burgy-day[data-value="8"]  { left: 644px; background-image: url('./assets/Both/8.png'); }
    #screen3 .burgy-day[data-value="10"] { left: 800px; background-image: url('./assets/Both/10.png'); }
    #screen3 .burgy-day[data-value="12"] { left: 950px; background-image: url('./assets/Both/12.png'); }
    #screen3 .burgy-day[data-value="14"] { left: 1104px; background-image: url('./assets/Both/14.png'); }
    #screen3 .burgy-day[data-value="16"] { left: 1256px; background-image: url('./assets/Both/16.png'); }
    #screen3 .burgy-day[data-value="18"] { left: 1410px; background-image: url('./assets/Both/18.png'); }
    #screen3 .burgy-day[data-value="20"] { left: 1560px; background-image: url('./assets/Both/20.png'); }

    #screen3 .mathy-day[data-value="3"]  { left: 265px; background-image: url('./assets/Both/3.png'); }
    #screen3 .mathy-day[data-value="6"]  { left: 494px; background-image: url('./assets/Both/6.png'); }
    #screen3 .mathy-day[data-value="9"]  { left: 720px; background-image: url('./assets/Both/9.png'); }
    #screen3 .mathy-day[data-value="12"] { left: 950px; background-image: url('./assets/Both/12.png'); }
    #screen3 .mathy-day[data-value="15"] { left: 1180px; background-image: url('./assets/Both/15.png'); }
    #screen3 .mathy-day[data-value="18"] { left: 1410px; background-image: url('./assets/Both/18.png'); }

    /* number buttons */
    .buttons-container {
      width: 90%;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 24px;
      z-index: 10;
    }

    .sideBtn {
      width: 5rem;
      height: 5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.6rem;
      font-weight: 600;
      color: #ccc;
      cursor: pointer;
      border-radius: 12px;
      outline: 4px solid #444;
      background-color: rgba(255, 255, 255, 0.04);
      user-select: none;
    }

    .sideBtn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    .sideBtn:not(.disabled):hover {
      transform: scale(1.07);
      background-color: #444;
    }

    .numBtns {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      flex-grow: 1;
    }
    
    .numBtn {
      width: 5.5rem;
      height: 5.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      font-size: 2.6rem;
      font-weight: 600;
      outline: 4px solid #fdbe35;
      color: #ffe082;
      background-color: rgba(253, 190, 53, 0.2);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      user-select: none;
    }
    
    .numBtn.correct, .numBtn.correct:hover {
      outline: 4px solid #4CAF50;
      color: #a5d6a7;
      background-color: rgba(76, 175, 80, 0.2);
      cursor: not-allowed;
      transform: none;
    }
    
    .numBtn.incorrect {
      outline: 4px solid #e57373;
      color: #ffcdd2;
      background-color: rgba(229, 115, 115, 0.2);
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .numBtn:not(.correct):hover {
      color: #fff;
      background-color: rgba(253, 190, 53, 0.8);
      transform: scale(1.07);
    }
    
    /* feedback box */
    .feedback-container {
      width: 90%;
      min-height: 120px;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.2rem;
      font-weight: 600;
      color: #ccc;
      border-radius: 12px;
      outline: 4px solid #444;
      background-color: rgba(255, 255, 255, 0.04);
      transition: all 0.3s ease-in-out;
      margin-top: 36px;
    }

    .feedback-text {
      text-align: center;
      line-height: 1.5;
    }
    
    .feedback-container.correct {
        outline-color: #4CAF50;
        color: #a5d6a7;
    }

    .feedback-container.incorrect {
        outline-color: #e57373;
        color: #ffcdd2;
    }

    /*
     * ====================================================================
     * ====================== start screen styles =========================
     * ====================================================================
    */
    .start-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      padding: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: relative;
      overflow: hidden;
    }

    .start-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="2.5" fill="rgba(255,255,255,0.1)"/><circle cx="10" cy="60" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
      animation: float 20s infinite linear;
      pointer-events: none;
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      100% { transform: translateY(-100px); }
    }

    .start-title {
      font-size: 4rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      margin-bottom: 40px;
      text-shadow: 0 4px 8px rgba(0,0,0,0.3);
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    .characters-container {
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      width: 100%;
      max-width: 1400px;
      margin-bottom: 50px;
      gap: 80px;
    }

    .character-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      transform: translateY(0);
      transition: all 0.3s ease;
      width: 500px;
      height: 600px;
      position: relative;
      overflow: hidden;
    }

    .character-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .character-card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 30px 60px rgba(0,0,0,0.3);
    }

    .burgy-card {
      border: 4px solid #FF6B9E;
      background: linear-gradient(135deg, #FFE5F1 0%, #FFB3D9 100%);
    }

    .mathy-card {
      border: 4px solid #4ECDC4;
      background: linear-gradient(135deg, #E8F8F7 0%, #B3F0EC 100%);
    }

    .character-image {
      width: 200px;
      height: 200px;
      margin: 0 auto 30px;
      border-radius: 50%;
      overflow: hidden;
      border: 6px solid #fff;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .character-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .character-name {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 20px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .burgy-card .character-name {
      color: #FF1B6B;
    }

    .mathy-card .character-name {
      color: #06A085;
    }

    .character-description {
      font-size: 2rem;
      line-height: 1.4;
      color: #333;
      margin-bottom: 10px;
    }

    .visit-frequency {
      font-weight: 700;
      font-size: 2.2rem;
    }

    .burgy-card .visit-frequency {
      color: #FF1B6B;
    }

    .mathy-card .visit-frequency {
      color: #06A085;
    }

    .question-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 15px;
      margin-bottom: 40px;
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
      border: 3px solid #FFD166;
    }

    .question-text {
      font-size: 2.52rem;
      font-weight: 600;
      color: #333;
      text-align: center;
      line-height: 1.3;
    }

    .new-start-button {
      background: #FF1B6B;
      color: white;
      border: 3px solid #fff;
      border-radius: 15px;
      padding: 25px 50px;
      font-size: 2.5rem;
      font-weight: 700;
      cursor: pointer;
      position: relative;
      z-index: 1000;
      pointer-events: auto;
      user-select: none;
      text-shadow: none;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      transition: background-color 0.2s ease;
    }

    .new-start-button:hover {
      background: #E91E63;
    }

    .new-start-button:active {
      background: #C2185B;
      transform: translateY(2px);
    }

    .start-screen-lang-toggle {
      position: absolute;
      top: 30px;
      right: 30px;
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid #fff;
      border-radius: 12px;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 2rem;
      font-weight: 700;
      color: #333;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
      z-index: 1000;
      user-select: none;
    }

    .start-screen-lang-toggle:hover {
      background: #fff;
      transform: translateY(-2px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.3);
    }

    .start-screen-lang-toggle:active {
      transform: translateY(0);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /*
     * ====================================================================
     * ====================== end screen styles ===========================
     * ====================================================================
    */
    .end-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      padding: 40px;
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 50%, #2E7D32 100%);
      position: relative;
      overflow: hidden;
    }

    .end-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.2)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.15)"/><circle cx="40" cy="70" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="2.5" fill="rgba(255,255,255,0.2)"/><circle cx="10" cy="60" r="1.5" fill="rgba(255,255,255,0.15)"/><polygon points="50,10 55,20 65,20 57,28 60,38 50,32 40,38 43,28 35,20 45,20" fill="rgba(255,215,0,0.3)"/><polygon points="15,45 18,50 25,50 20,55 22,62 15,58 8,62 10,55 5,50 12,50" fill="rgba(255,215,0,0.2)"/><polygon points="85,65 88,70 95,70 90,75 92,82 85,78 78,82 80,75 75,70 82,70" fill="rgba(255,215,0,0.25)"/></svg>') repeat;
      animation: celebrate 15s infinite linear;
      pointer-events: none;
    }

    @keyframes celebrate {
      0% { transform: translateY(0px) rotate(0deg); }
      100% { transform: translateY(-100px) rotate(360deg); }
    }

    .end-title {
      font-size: 4.5rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 0 4px 8px rgba(0,0,0,0.3);
      animation: celebration-bounce 2s infinite;
    }

    @keyframes celebration-bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
      40% { transform: translateY(-15px) scale(1.05); }
      60% { transform: translateY(-8px) scale(1.02); }
    }

    .end-subtitle {
      font-size: 2.8rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.95);
      text-align: center;
      margin-bottom: 40px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      line-height: 1.3;
    }

    .end-characters-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 40px;
      gap: 60px;
    }

    .end-character-image {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      overflow: hidden;
      border: 6px solid #fff;
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
      animation: happy-pulse 2.5s infinite;
      position: relative;
    }

    @keyframes happy-pulse {
      0% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.08) rotate(2deg); }
      50% { transform: scale(1.05) rotate(0deg); }
      75% { transform: scale(1.08) rotate(-2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    .end-character-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .end-summary-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      padding: 40px;
      margin-bottom: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      border: 4px solid #FFD700;
      max-width: 1200px;
      width: 90%;
    }

    .end-summary-title {
      font-size: 3rem;
      font-weight: 700;
      color: #2E7D32;
      text-align: center;
      margin-bottom: 25px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .end-summary-text {
      font-size: 2.4rem;
      font-weight: 600;
      color: #333;
      text-align: center;
      line-height: 1.4;
      margin-bottom: 20px;
    }

    .end-lcm-highlight {
      font-size: 2.8rem;
      font-weight: 700;
      color: #FF1B6B;
      background: linear-gradient(135deg, #FFE5F1 0%, #FFB3D9 100%);
      padding: 15px 30px;
      border-radius: 15px;
      border: 3px solid #FF6B9E;
      text-align: center;
      margin: 20px 0;
      box-shadow: 0 8px 16px rgba(255, 107, 158, 0.3);
    }

    .end-buttons-container {
      display: flex;
      gap: 40px;
      justify-content: center;
      align-items: center;
    }

    .end-button {
      background: linear-gradient(145deg, #FFD700, #FFC107);
      color: #333;
      border: 4px solid #fff;
      border-radius: 20px;
      padding: 20px 40px;
      font-size: 2.4rem;
      font-weight: 700;
      cursor: pointer;
      position: relative;
      z-index: 1000;
      pointer-events: auto;
      user-select: none;
      text-shadow: none;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .end-button:hover {
      background: linear-gradient(145deg, #FFC107, #FF9800);
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.4);
    }

    .end-button:active {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }

    .end-button.primary {
      background: linear-gradient(145deg, #4CAF50, #45a049);
      color: white;
    }

    .end-button.primary:hover {
      background: linear-gradient(145deg, #45a049, #388e3c);
    }

    .end-screen-lang-toggle {
      position: absolute;
      top: 30px;
      right: 30px;
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid #fff;
      border-radius: 12px;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 2rem;
      font-weight: 700;
      color: #333;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
      z-index: 1000;
      user-select: none;
    }

    .end-screen-lang-toggle:hover {
      background: #fff;
      transform: translateY(-2px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.3);
    }

    .end-screen-lang-toggle:active {
      transform: translateY(0);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

  </style>
</head>

<body>
  <div class="marquee">
    <div class="marquee-content">Temukan konten dan modul lengkap menggunakan PID, lewat aplikasi Teman Belajar</div>
  </div>
  <div class="scale-container">
    <div class="scale-wrapper">
        <div class="applet-canvas">
          <div class="applet-container">
            <img src="./assets/logo.png" alt="Logo" class="logo">
            <div class="assets">
            <div class="workingArea-container">
              <div class="instruction" id="instructionText">
                <!-- Language toggle button removed -->
              </div>
              <div class="workingArea">
                <div class="content-screen active" id="screen0"></div>
                <div class="content-screen" id="screen1"></div>
                <div class="content-screen" id="screen2"></div>
                <div class="content-screen" id="screen3"></div>
                <div class="content-screen" id="screen4"></div>
              </div>
              <div class="lowerControls">
                <div class="navigation">
                  <button class="nav-btn" id="prevButton" disabled>Previous</button>
                  <div class="progress-container" id="progressContainer"></div>
                  <button class="nav-btn" id="nextButton">Next</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // ====================== STATE & CONFIG ======================
    // ============================================================
    let currentScreen = 0;
    const totalScreens = 5;
    let lang = 'id'; // Set default language to Indonesian

    // ============================================================
    // ====================== AUDIO FUNCTIONS =====================
    // ============================================================
    function playSound(frequency, duration = 200, type = 'sine') {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
        oscillator.type = type;
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration / 1000);
      } catch (e) {
        console.log('Audio not available');
      }
    }
    
    function playClickSound() {
      playSound(600, 40, 'sine');
      setTimeout(() => playSound(800, 20, 'sine'), 40);
    }
    
    function playNavigationSound() {
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          playSound(600 - (i * 40), 30, 'sine');
        }, i * 20);
      }
    }
    
    function playCorrectSound() {
      playSound(784, 80, 'triangle');
      playSound(988, 80, 'triangle');
      setTimeout(() => playSound(1319, 200, 'triangle'), 160);
      
      setTimeout(() => {
        for (let i = 0; i < 4; i++) {
          setTimeout(() => {
            playSound(1500 + (i * 200), 60, 'triangle');
          }, i * 60);
        }
      }, 360);
    }
    
    function playIncorrectSound() {
      playSound(392, 100, 'sine');
      setTimeout(() => playSound(330, 300, 'sine'), 100);
      
      setTimeout(() => {
        playSound(349, 80, 'sine');
      }, 400);
    }

    function playEndSound() {
      // Extended celebration sound for completing the entire activity
      playSound(523, 120, 'triangle'); // C5
      setTimeout(() => playSound(659, 120, 'triangle'), 120); // E5
      setTimeout(() => playSound(784, 120, 'triangle'), 240); // G5
      setTimeout(() => playSound(1047, 200, 'triangle'), 360); // C6
      
      setTimeout(() => {
        for (let i = 0; i < 6; i++) {
          setTimeout(() => {
            playSound(1047 + (i * 100), 80, 'triangle');
          }, i * 80);
        }
      }, 560);
      
      // Add some sparkle effects
      setTimeout(() => {
        for (let i = 0; i < 8; i++) {
          setTimeout(() => {
            playSound(1500 + Math.random() * 500, 40, 'triangle');
          }, i * 100);
        }
      }, 1000);
    }

    const appData = {
      burgy: { name: 'Burgy', interval: 2, multiples: [2, 4, 6, 8, 10, 12, 14, 16, 18, 20], selected: [], numPadPage: 1 },
      mathy: { name: 'Mathy', interval: 3, multiples: [3, 6, 9, 12, 15, 18], selected: [], numPadPage: 1 },
      commonMultiples: [6, 12, 18],
      lcm: 6,
      maxDay: 20,
    };

    const langText = {
        en: {
            prevButton: 'Previous', nextButton: 'Next', finishButton: 'Finish', startButton: 'Start Adventure!', playAgainButton: 'Play Again', endButton: 'End',
            useArrows: 'Use the arrows near the numbers to reveal more numbers...',
            screen0: { instruction: 'Meet Burgy & Mathy!', title: 'Meet Burgy & Mathy!', burgyDescription: 'Burgy visits the park every', mathyDescription: 'Mathy visits every', question: 'When will Burgy and Mathy meet for the first time at the park?' },
            screen1: { instruction: `Burgy visits the park every <span class="focus">2 days</span>. Tap the days Burgy visits the park...`, feedbackCorrect: `Good job! Burgy visits the park on Day <span class="focus">{0}</span>... Select the other days.`, feedbackIncorrect: `Oops! <span class="focus">{0}</span> is not a multiple of <span class="focus">2</span>...`, feedbackComplete: `Good job! That's all the days Burgy visits the park... Click next...` },
            screen2: { instruction: `Mathy visits the park every <span class="focus">3 days</span>. Tap the days Mathy visits the park...`, feedbackCorrect: `Good job! Mathy visits the park on Day <span class="focus">{0}</span>... Select the other days.`, feedbackIncorrect: `Oops! <span class="focus">{0}</span> is not a multiple of <span class="focus">3</span>...`, feedbackComplete: `Good job! That's all the days Mathy visits the park... Click next...` },
            screen3: { instruction: `From the days marked below, select the <span class="focus">FIRST</span> day they would meet at the park.`, initialFeedback: 'Tap one of the days to see if they meet.', feedbackIncorrectNotFirst: `Day <span class="focus">{0}</span> is a common multiple, but it's not the <span class="focus">FIRST</span> day they meet. Try again!`, feedbackCorrect: `Good job! Both Burgy and Mathy would meet for the <span class="focus">FIRST TIME</span> on Day <span class="focus">6</span> – 6 is the LEAST COMMON MULTIPLE of 2 and 3!`, feedbackIncorrectNotCommon: `Oops! <span class="focus">{0}</span> is not a common multiple. They don't meet on that day.` },
            screen4: { title: 'Congratulations!', subtitle: 'You have successfully mastered finding the Least Common Multiple!', summaryTitle: 'What You Learned', summaryText: 'Thanks to you, Burgy and Mathy now know they will meet every 6 days at the park!', lcmHighlight: 'The LCM of 2 and 3 is 6 - the first day they both visit!' }
        },
        id: {
            prevButton: 'Sebelumnya', nextButton: 'Berikutnya', finishButton: 'Selesai', startButton: 'Mulai Petualangan!', playAgainButton: 'Main Lagi', endButton: 'Selesai',
            useArrows: 'Gunakan panah di dekat angka untuk menampilkan lebih banyak angka...',
            screen0: { instruction: 'Kenalan sama Burgy & Matthew!', title: 'Kenalan sama Burgy & Matthew!', burgyDescription: 'Burgy mengunjungi taman setiap', mathyDescription: 'Matthew mengunjungi taman setiap', question: 'Mari kita cari tahu kapan Burgy dan Matthew akan bertemu lagi, dengan menggunakan KPK!' },
            screen1: { instruction: `Burgy mengunjungi taman setiap <span class="focus">2 hari</span>. Ketuk hari-hari saat Burgy mengunjungi taman...`, feedbackCorrect: `Kerja bagus! Burgy mengunjungi taman pada Hari ke-<span class="focus">{0}</span>... Pilih hari lainnya.`, feedbackIncorrect: `Ups! <span class="focus">{0}</span> bukan kelipatan dari <span class="focus">2</span>...`, feedbackComplete: `Kerja bagus! Itulah semua hari Burgy mengunjungi taman... Klik berikutnya...` },
            screen2: { instruction: `Matthew mengunjungi taman setiap <span class="focus">3 hari</span>. Ketuk hari-hari saat Matthew mengunjungi taman...`, feedbackCorrect: `Kerja bagus! Matthew mengunjungi taman pada Hari ke-<span class="focus">{0}</span>... Pilih hari lainnya.`, feedbackIncorrect: `Ups! <span class="focus">{0}</span> bukan kelipatan dari <span class="focus">3</span>...`, feedbackComplete: `Kerja bagus! Itulah semua hari Matthew mengunjungi taman... Klik berikutnya...` },
            screen3: { instruction: `Dari hari-hari yang disorot dengan warna kuning, pilih hari <span class="focus">PERTAMA</span> mereka akan bertemu di taman.`, initialFeedback: 'Ketuk salah satu hari untuk melihat apakah mereka bertemu.', feedbackIncorrectNotFirst: `Hari ke-<span class="focus">{0}</span> adalah kelipatan persekutuan, tetapi itu bukan hari <span class="focus">PERTAMA</span> mereka bertemu. Coba lagi!`, feedbackCorrect: `Kerja bagus! Burgy dan Matthew akan bertemu untuk <span class="focus">PERTAMA KALI</span> pada Hari ke-<span class="focus">6</span> dan 6 adalah KELIPATAN PERSEKUTUAN TERKECIL dari 2 dan 3!`, feedbackIncorrectNotCommon: `Ups! <span class="focus">{0}</span> bukan kelipatan persekutuan. Mereka tidak bertemu pada hari itu.` },
            screen4: { title: 'Selamat!', subtitle: 'kalian telah berhasil menguasai cara mencari Kelipatan Persekutuan Terkecil!', summaryTitle: 'Apa yang kalian Pelajari', summaryText: 'Berkat kalian, Burgy dan Matthew sekarang tahu mereka akan bertemu setiap 6 hari di taman!', lcmHighlight: 'KPK dari 2 dan 3 adalah 6 - hari pertama mereka berdua berkunjung!' }
        }
    };

    // ===========================================================
    // ====================== INITIALIZATION =====================
    // ===========================================================
    function initializeApplet() {
      calculateScale();
      setupEventListeners();
      setupNavigation();
      currentScreen = -1; // Force initialization
      switchToScreen(0);
    }

    function setupEventListeners() {
      window.addEventListener('resize', calculateScale);
      // Language toggle functionality removed since button is hidden
    }

    // ======================================================
    // ====================== UI SETUP ======================
    // ======================================================
    function setupNavigation() {
      const nextBtn = document.getElementById('nextButton');
      const prevBtn = document.getElementById('prevButton');
      prevBtn.addEventListener('click', () => {
        playNavigationSound();
        switchToScreen(currentScreen - 1);
      });
      nextBtn.addEventListener('click', () => {
        playNavigationSound();
        if(currentScreen < totalScreens) switchToScreen(currentScreen + 1);
      });
      const progressContainer = document.getElementById('progressContainer');
      progressContainer.innerHTML = '';
      // Only create progress dots for learning screens (1, 2, 3), not the start screen (0) or end screen (4)
      for (let i = 1; i < totalScreens - 1; i++) {
        const dot = document.createElement('div');
        dot.className = 'progress-dot'; dot.dataset.screen = i; progressContainer.appendChild(dot);
      }
    }

    function setupInteractiveScreen(screenNum, charKey) {
        const character = appData[charKey];
        const screenEl = document.getElementById(`screen${screenNum}`);
        let generationAreaHTML = '';
        character.multiples.forEach(i => {
             generationAreaHTML += `<div class="${character.name.toLowerCase()}-day" data-value="${i}"></div>`;
        });

        screenEl.innerHTML = `
            <div class="interactive-pane">
                <div class="frame-container" id="frame-container-${screenNum}">
                    <img class="number-line-base" src="./assets/${character.name}/${character.name} number line.png" alt="${character.name} number line">
                    <div class="generation-area">${generationAreaHTML}</div>
                </div>
                <div class="buttons-container">
                    <div class="sideBtn leftBtn" id="leftBtn-${screenNum}">◀</div>
                    <div class="numBtns" id="numBtns-${screenNum}"></div>
                    <div class="sideBtn rightBtn" id="rightBtn-${screenNum}">▶</div>
                </div>
                <div class="feedback-container" id="feedback-container-${screenNum}">
                    <div class="feedback-text" id="feedback-text-${screenNum}"></div>
                </div>
            </div>`;

        generateNumberPad(screenNum, charKey);
        updateMarkers(screenNum, charKey);

        document.getElementById(`leftBtn-${screenNum}`).addEventListener('click', () => { 
          if (character.numPadPage > 1) { 
            playClickSound();
            character.numPadPage--; 
            generateNumberPad(screenNum, charKey); 
          } 
        });
        document.getElementById(`rightBtn-${screenNum}`).addEventListener('click', () => { 
          if (character.numPadPage < 2) { 
            playClickSound();
            character.numPadPage++; 
            generateNumberPad(screenNum, charKey); 
          } 
        });
        document.getElementById(`feedback-text-${screenNum}`).innerHTML = langText[lang].useArrows;
    }

    function generateNumberPad(screenNum, charKey) {
        const character = appData[charKey];
        const numBtnsContainer = document.getElementById(`numBtns-${screenNum}`);
        numBtnsContainer.innerHTML = '';
        const startNum = (character.numPadPage - 1) * 10 + 1;
        const endNum = Math.min(startNum + 9, appData.maxDay);
        for (let i = startNum; i <= endNum; i++) {
            const numBtn = document.createElement('div');
            numBtn.className = 'numBtn'; numBtn.textContent = i; numBtn.dataset.value = i;
            if (character.selected.includes(i)) { numBtn.classList.add('correct'); } 
            else { numBtn.addEventListener('click', () => handleNumberClick(i, screenNum, charKey)); }
            numBtnsContainer.appendChild(numBtn);
        }
        document.getElementById(`leftBtn-${screenNum}`).classList.toggle('disabled', character.numPadPage === 1);
        document.getElementById(`rightBtn-${screenNum}`).classList.toggle('disabled', character.numPadPage === 2);
    }
    
    function setupStartScreen() {
        const screenEl = document.getElementById('screen0');
        const currentLang = langText[lang].screen0;
        
        screenEl.innerHTML = `
            <div class="start-screen">
                <!-- Language toggle button removed -->
                <h1 class="start-title">${currentLang.title}</h1>
                <div class="characters-container">
                    <div class="character-card burgy-card">
                        <div class="character-image">
                            <img src="./assets/Burgy.png" alt="Burgy">
                        </div>
                        <div class="character-name">Burgy</div>
                        <div class="character-description">${currentLang.burgyDescription}</div>
                        <div class="visit-frequency">2 hari</div>
                    </div>
                    <div class="character-card mathy-card">
                        <div class="character-image">
                            <img src="./assets/Mathy.png" alt="Mathy">
                        </div>
                        <div class="character-name">Matthew</div>
                        <div class="character-description">${currentLang.mathyDescription}</div>
                        <div class="visit-frequency">3 hari</div>
                    </div>
                </div>
                <div class="question-section">
                    <div class="question-text">${currentLang.question}</div>
                </div>
                <button class="new-start-button" id="newStartButton" onclick="startAdventure()">${langText[lang].startButton}</button>
            </div>`;
        
        // Language toggle functionality removed since button is hidden
    }

    function setupFinalScreen() {
        const screenEl = document.getElementById('screen3');
        let generationAreaHTML = '';

        appData.burgy.selected.forEach(num => {
            generationAreaHTML += `<div class="burgy-day active" data-value="${num}"></div>`;
        });
        
        appData.mathy.selected.forEach(num => {
            generationAreaHTML += `<div class="mathy-day active" data-value="${num}"></div>`;
        });
        
        screenEl.innerHTML = `
            <div class="interactive-pane">
                <div class="frame-container" id="frame-container-3">
                    <img class="number-line-base" src="./assets/Both/Burgy & Mathy Number Line.png" alt="Combined number line">
                    <div class="generation-area">${generationAreaHTML}</div>
                </div>
                <div class="feedback-container" id="feedback-container-3">
                    <div class="feedback-text" id="feedback-text-3"></div>
                </div>
            </div>`;
        
        document.querySelectorAll('#screen3 .burgy-day, #screen3 .mathy-day').forEach(marker => {
            marker.addEventListener('click', (e) => {
                e.stopPropagation(); 
                handleFinalClick(parseInt(marker.dataset.value));
            });
        });
        document.getElementById('feedback-text-3').innerHTML = langText[lang].screen3.initialFeedback;
    }

    function setupEndScreen() {
        const screenEl = document.getElementById('screen4');
        const currentLang = langText[lang].screen4;
        
        screenEl.innerHTML = `
            <div class="end-screen">
                <!-- Language toggle button removed -->
                <h1 class="end-title">${currentLang.title}</h1>
                <div class="end-subtitle">${currentLang.subtitle}</div>
                <div class="end-characters-container">
                    <div class="end-character-image">
                        <img src="./assets/Burgy.png" alt="Burgy">
                    </div>
                    <div class="end-character-image">
                        <img src="./assets/Mathy.png" alt="Mathy">
                    </div>
                </div>
                <div class="end-summary-section">
                    <div class="end-summary-title">${currentLang.summaryTitle}</div>
                    <div class="end-summary-text">${currentLang.summaryText}</div>
                    <div class="end-lcm-highlight">${currentLang.lcmHighlight}</div>
                </div>
                <div class="end-buttons-container">
                    <button class="end-button primary" onclick="playAgain()">${langText[lang].playAgainButton}</button>
                    <button class="end-button" onclick="endApplet()">${langText[lang].endButton}</button>
                </div>
            </div>`;
        
        // Language toggle functionality removed since button is hidden
    }
    
    // ====================================================================
    // ====================== INTERACTION HANDLERS ======================
    // ====================================================================
    function handleNumberClick(num, screenNum, charKey) {
        const character = appData[charKey];
        const feedbackContainer = document.getElementById(`feedback-container-${screenNum}`);
        const feedbackText = document.getElementById(`feedback-text-${screenNum}`);
        const button = document.querySelector(`#numBtns-${screenNum} .numBtn[data-value='${num}']`);
        if (character.multiples.includes(num)) {
            playCorrectSound();
            if (!character.selected.includes(num)) {
                character.selected.push(num);
                character.selected.sort((a,b) => a-b);
            }
            button.classList.add('correct');
            button.replaceWith(button.cloneNode(true)); 
            feedbackContainer.className = 'feedback-container correct';
            
            updateMarkers(screenNum, charKey);

            if (character.selected.length === character.multiples.length) {
                document.getElementById('nextButton').disabled = false;
                feedbackText.innerHTML = langText[lang][`screen${screenNum}`].feedbackComplete;
                
                const baseImage = document.querySelector(`#screen${screenNum} .number-line-base`);
                const individualMarkers = document.querySelectorAll(`#screen${screenNum} .generation-area > div`);
                
                const allSelectedImage = (charKey === 'burgy') ? 'All 2.png' : 'All of 3.png';
                if (baseImage) {
                    baseImage.src = `./assets/${character.name}/${allSelectedImage}`;
                }
                individualMarkers.forEach(marker => {
                    marker.style.opacity = 0;
                });
            } 
            else {
                feedbackText.innerHTML = format(langText[lang][`screen${screenNum}`].feedbackCorrect, num);
            }
        } else {
            playIncorrectSound();
            feedbackContainer.className = 'feedback-container incorrect';
            feedbackText.innerHTML = format(langText[lang][`screen${screenNum}`].feedbackIncorrect, num, character.interval);
            button.classList.add('incorrect');
            setTimeout(() => { button.classList.remove('incorrect'); feedbackContainer.className = 'feedback-container'; feedbackText.innerHTML = langText[lang].useArrows; }, 2000);
        }
    }

    function handleFinalClick(num) {
        const feedbackContainer = document.getElementById('feedback-container-3');
        const feedbackText = document.getElementById('feedback-text-3');

        // Find the specific marker(s) that were clicked
        const clickedMarkers = document.querySelectorAll(`#screen3 [data-value="${num}"]`);
        
        // Apply the "result" image to the clicked marker(s)
        clickedMarkers.forEach(marker => {
            marker.style.backgroundImage = `url(./assets/Results/${num}.png)`;
        });

        // Update feedback text based on the logic
        if (num === appData.lcm) {
            playCorrectSound();
            feedbackContainer.className = 'feedback-container correct';
            feedbackText.innerHTML = langText[lang].screen3.feedbackCorrect;
            document.getElementById('nextButton').disabled = false;
            document.querySelectorAll('#screen3 .burgy-day, #screen3 .mathy-day').forEach(el => el.style.pointerEvents = 'none');
        } else if (appData.commonMultiples.includes(num)) {
            playIncorrectSound();
            feedbackContainer.className = 'feedback-container incorrect';
            feedbackText.innerHTML = format(langText[lang].screen3.feedbackIncorrectNotFirst, num);
        } else {
            playIncorrectSound();
            feedbackContainer.className = 'feedback-container incorrect';
            feedbackText.innerHTML = format(langText[lang].screen3.feedbackIncorrectNotCommon, num);
        }
    }

    // =============================================================
    // ====================== HELPER FUNCTIONS =====================
    // =============================================================
    function calculateScale() {
      const container = document.querySelector('.scale-container');
      const wrapper = document.querySelector('.scale-wrapper');
      const scaleX = container.clientWidth / 1920; const scaleY = container.clientHeight / 1080;
      const scale = Math.min(scaleX, scaleY); wrapper.style.transform = `scale(${scale})`;
    }

    function switchToScreen(screenNum) {
      if (screenNum < 0 || screenNum >= totalScreens || screenNum === currentScreen) return;
      const oldScreen = document.getElementById(`screen${currentScreen}`);
      if(oldScreen) oldScreen.classList.remove('active');
      currentScreen = screenNum;
      const activeScreen = document.getElementById(`screen${currentScreen}`);
      if (activeScreen) activeScreen.classList.add('active');
      document.querySelectorAll('.progress-dot').forEach(dot => {
        dot.classList.remove('active', 'completed');
        if (parseInt(dot.dataset.screen) < currentScreen) dot.classList.add('completed');
        if (parseInt(dot.dataset.screen) === currentScreen) dot.classList.add('active');
      });
      if(screenNum === 1) appData.burgy.numPadPage = 1;
      if(screenNum === 2) appData.mathy.numPadPage = 1;
      if (currentScreen === 0) setupStartScreen();
      if (currentScreen === 1) setupInteractiveScreen(1, 'burgy');
      if (currentScreen === 2) setupInteractiveScreen(2, 'mathy');
      if (currentScreen === 3) setupFinalScreen();
      if (currentScreen === 4) {
        setupEndScreen();
        // Play special end celebration sound when reaching the final screen
        setTimeout(() => playEndSound(), 500);
      }
      updateText();
      updateNavButtons();
    }

    function updateNavButtons() {
        const prevBtn = document.getElementById('prevButton');
        const nextBtn = document.getElementById('nextButton');
        const progressContainer = document.getElementById('progressContainer');
        
        if (currentScreen === 0 || currentScreen === 4) {
            // Hide all navigation on start screen and end screen
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            progressContainer.style.display = 'none';
        } else {
            // Show navigation for learning screens
            prevBtn.style.display = 'block';
            nextBtn.style.display = 'block';
            progressContainer.style.display = 'flex';
            
            prevBtn.disabled = (currentScreen <= 1);
            if (currentScreen === 1) { nextBtn.disabled = appData.burgy.selected.length !== appData.burgy.multiples.length; } 
            else if (currentScreen === 2) { nextBtn.disabled = appData.mathy.selected.length !== appData.mathy.multiples.length; } 
            else if (currentScreen === 3) { const isComplete = document.querySelector('#feedback-container-3.correct') !== null; nextBtn.disabled = !isComplete; }
        }
    }

    function updateText() {
        const currentLang = langText[lang];
        document.getElementById('prevButton').textContent = currentLang.prevButton;
        const nextBtn = document.getElementById('nextButton');
        nextBtn.textContent = (currentScreen === totalScreens) ? currentLang.finishButton : currentLang.nextButton;
        const instructionEl = document.getElementById('instructionText');
        if(instructionEl){
            if (currentScreen === 0 || currentScreen === 4) {
                instructionEl.style.display = 'none';
            } else {
                instructionEl.style.display = 'block';
                if (currentScreen === 1) instructionEl.innerHTML = currentLang.screen1.instruction;
                else if (currentScreen === 2) instructionEl.innerHTML = currentLang.screen2.instruction;
                else if (currentScreen === 3) instructionEl.innerHTML = currentLang.screen3.instruction;
            }
        }
    }
    
    function updateMarkers(screenNum, charKey) {
        const character = appData[charKey];
        const markerElements = document.querySelectorAll(`#screen${screenNum} .${character.name.toLowerCase()}-day`);
        markerElements.forEach(marker => {
            const val = parseInt(marker.dataset.value);
            marker.classList.toggle('active', character.selected.includes(val));
        });
    }

    function format(str, ...values) { return str.replace(/{(\d+)}/g, (match, index) => values[index] !== undefined ? values[index] : match); }

    // Global function for start button onclick
    function startAdventure() {
        playClickSound();
        console.log('Start Adventure button clicked!');
        switchToScreen(1);
    }

    // Global functions for end screen buttons
    function playAgain() {
        playClickSound();
        // Reset all data
        appData.burgy.selected = [];
        appData.mathy.selected = [];
        appData.burgy.numPadPage = 1;
        appData.mathy.numPadPage = 1;
        
        // Go back to start screen
        switchToScreen(0);
    }

    function endApplet() {
        playClickSound();
        // You can customize this behavior - for now it shows an alert
        alert(lang === 'en' ? 'Thank you for playing!' : 'Terima kasih telah bermain!');
        // Optionally reload the page or close the window
        // window.location.reload();
    }

    document.addEventListener('DOMContentLoaded', initializeApplet);
  </script>
</body>
</html>
